version: "2"
sql:
  - engine: postgresql
    queries: database/queries
    schema: database/schema.sql
    # database:
    #   uri: postgres://${DB_USERNAME}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_DATABASE}?sslmode=disable
    rules:
      - sqlc/db-prepare
      - postgresql-query-too-costly
      - postgresql-no-seq-scan
      # - debug
    gen:
      go:
        package: postgres
        out: internal/infrastructure/repository/postgres/
        sql_package: pgx/v5
        query_parameter_limit: 0
        overrides:
          - db_type: uuid
            nullable: false
            go_type:
              import: github.com/google/uuid
              type: "UUID"
        rename:
          ids: IDs
          url: URL
          urls: URLs
          sku: SKU
          skus: SKUs
          image_url: ImageURL
          image_urls: ImageURLs
          user_id: userID
          product_ids: ProductIDs
          product_variant_ids: ProductVariantIDs
          options_ids: OptionsIDs
          option_value_ids: OptionValueIDs
          attribute_ids: AttributeIDs
          attribute_value_ids: AttributeValueIDs
          category_ids: CategoryIDs
          cart_ids : CartIDs
          cart_items_ids : CartItemIDs
rules:
  - name: postgresql-query-too-costly
    message: "Query cost estimate is too high"
    rule: "postgresql.explain.plan.total_cost > 1.0"
  - name: postgresql-no-seq-scan
    message: "Query plan results in a sequential scan"
    rule: "postgresql.explain.plan.node_type == 'Seq Scan'"
  - name: debug
    rule: "!has(postgresql.explain)"
